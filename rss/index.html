<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[ItsIgnacioPortal's Blog]]></title><description><![CDATA[Thoughts, stories and ideas.]]></description><link>https://itsignacioportal.github.io/</link><image><url>https://itsignacioportal.github.io/favicon.png</url><title>ItsIgnacioPortal&apos;s Blog</title><link>https://itsignacioportal.github.io/</link></image><generator>Ghost 4.48</generator><lastBuildDate>Sat, 12 Jul 2025 07:46:05 GMT</lastBuildDate><atom:link href="https://itsignacioportal.github.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)]]></title><description><![CDATA[No root or external servers neeeded. Requirements: Android 5.0+, 
446.03 MB of available storage, a computer and a cable to connect your phone.]]></description><link>https://itsignacioportal.github.io/firewall-and-vpn-without-root-on-android-2025/</link><guid isPermaLink="false">684b04d291c5dd109ce07b3e</guid><category><![CDATA[Privacy]]></category><category><![CDATA[No Root]]></category><category><![CDATA[VPN]]></category><category><![CDATA[How to]]></category><dc:creator><![CDATA[Ignacio J. Perez Portal]]></dc:creator><pubDate>Tue, 24 Jun 2025 22:21:48 GMT</pubDate><media:content url="https://itsignacioportal.github.io/content/images/2025/07/ABSOLUTE-PRIVACY-5.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://itsignacioportal.github.io/content/images/2025/07/ABSOLUTE-PRIVACY-5.jpg" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)"><p>&#x2705; You&apos;re reading the latest version of this guide.</p><p>It&apos;s often considered impossible to use both a firewall and a VPN at the same time on android without root, mainly due to the fact that you can normally only connect to a single VPN at a time, and firewall apps require this &#x201C;VPN slot&#x201D; in order to capture all device traffic.</p><p>But by taking advantage of the <strong>Android Work Profile</strong>, it&apos;s actually possible to connect to two VPNs at the same time, allowing use of a firewall app and an actual VPN app at the simultaneously.</p><!--kg-card-begin: html--> <button type="button" class="collapsible">What is an Android &quot;Work Profile&quot;?</button>
<div class="content gh-content"><!--kg-card-end: html--><h3 id="android-work-profiles">Android Work Profiles</h3><p>An android work profile is an independent environment from the main Android profile, where much of the personal data has a completely separate storage from the main one. Android work-profiles give apps their own storage for:</p><ul><li>SMS History</li><li>Call History</li><li>File Storage</li></ul><p>In theory, this would allow you to run two instances of the same app simultaneously, each with its own independent storage, facilitating the separation of work-related accounts and accounts for personal use.</p><p>The greatest benefit of android Work Profiles is that <strong>they enable the use of two VPNs simultaneously.</strong></p><p><a href="https://developer.android.com/work/managed-profiles">Official documentation for the Android work-profile.</a></p><!--kg-card-begin: html--></div><!--kg-card-end: html--><p><strong>Technical overview:</strong> To properly route all network traffic where it corresponds we&apos;re going to install InviziblePRO-BETA in the main profile, setup a work-profile using Insular, connect InviziblePRO-BETA to a SOCKS5 proxy managed by Sing-Box from the work-profile, and then setup ProtonVPN to manage all work-profile connections.</p><p>Below is a simplified flowchart that visualizes the entire setup.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/06/Firewall-and-VPN-diagram.webp" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="1278" height="726" srcset="https://itsignacioportal.github.io/content/images/size/w600/2025/06/Firewall-and-VPN-diagram.webp 600w, https://itsignacioportal.github.io/content/images/size/w1000/2025/06/Firewall-and-VPN-diagram.webp 1000w, https://itsignacioportal.github.io/content/images/2025/06/Firewall-and-VPN-diagram.webp 1278w" sizes="(min-width: 720px) 720px"><figcaption>Flowchart visualization.</figcaption></figure><p>This guide has been tested on Lineage OS v19 (Based on Android 12). The following security tests were ran through this setup: testing for IP address leaks, DNS leaks and UDP leaks. No issues were detected in this configuration. Additionally, this setup only uses free and open source software.</p><hr><h2 id="index">Index</h2><!--kg-card-begin: markdown--><ul>
<li><a href="#alternative-solutions">Alternative solutions</a></li>
<li><a href="#requirements">Requiremenets</a></li>
<li><a href="#setup">Setup</a>
<ul>
<li><a href="#getting-an-f-droid-client">Getting an F-Droid Client</a></li>
<li><a href="#insular-or-shelter">Insular or Shelter?</a></li>
<li><a href="#setup-inviziblepro-beta">Setup InviziblePRO BETA</a></li>
<li><a href="#setup-sing-box">Setup Sing-Box</a></li>
<li><a href="#inviziblepro-beta-socks5-proxy-setup">InviziblePRO BETA SOCKS5 Proxy Setup</a></li>
<li><a href="#setup-the-real-vpn">Setup the real VPN</a></li>
</ul>
</li>
<li><a href="#start-everything">Start everything</a></li>
<li><a href="#verifying-everything-works">Verifying everything works</a></li>
<li><a href="#hardening">Hardening</a></li>
<li><a href="#faq">F.A.Q.</a>
<ul>
<li><a href="#where-do-i-install-apps">Where do I install apps?</a></li>
<li><a href="#how-do-i-block-an-apps-internet-access">How do I block an app&apos;s internet access?</a></li>
<li><a href="#how-do-i-setup-dns-filtering">How do I setup DNS filtering?</a></li>
<li><a href="#how-do-i-update-sing-box-and-the-vpn-app">How do I update Sing-Box and the VPN app?</a></li>
<li><a href="#how-do-i-exclude-an-app-from-the-vpn">How do I exclude an app from the VPN?</a></li>
</ul>
</li>
</ul>
<!--kg-card-end: markdown--><hr><h2 id="alternative-solutions">Alternative solutions</h2><p>Before arriving at this configuration, many alternative solutions were considered.</p><p><strong>Proposal #1:</strong> Instead of using a VPN app, just install any firewall app and connect to an external SOCKS5 proxy server. This would have the benefit of masking the source IP when interacting with the internet, and also not having to use so many apps simultaneously. Encrypted DNS resolutions could be achieved by using the android built-in &quot;Private DNS&quot; feature, which uses DoH.</p><p><strong>Problem 1-A:</strong> The SOCKS5 protocol is not encrypted. All content is sent as-is from the SOCKS5 client to the SOCKS5 server. This would mean that network content such as insecure HTTP and DoH resolver addresses can still be intercepted by network intruders and ISPs.</p><p><strong>Problem 1-B: </strong>VPN providers offer just that, VPNs. To get a SOCKS5 proxy server that you can trust you&apos;d need to set it up yourself, which would cause you to have recurring monthly costs, but only a portion of the benefits of a full-fledged VPN.</p><p></p><p><strong>Proposal #2:</strong> Don&apos;t use a dedicated firewall app. Instead just use regular VPN app, enable <em>Settings &#x2192; Network and Internet &#x2192; VPN &#x2192; Your-VPN-Here &#x2192; Block connections without VPN</em>, and then enable <a href="https://protonvpn.com/support/protonvpn-split-tunneling/">split-tunneling</a> on your VPN app. This would allow selective blocking of internet access to any android app, while also maintaining all of the benefits of a full VPN.</p><p><strong>Problem 2-A:</strong> No network-specific filtering. When using the split-tunneling configuration, either you allow full network access, or you block it completely. There is no fine-grained control. With a dedicated firewall app you could control LAN access, mobile data access, and wifi access separately. This fine-grained access allows you to restrict LAN access while still allowing WiFi access, preventing attackers (<a href="https://news.ycombinator.com/item?id=23246170">Like eBay or BeFF</a>) from scanning your local WiFi.</p><p><strong>Problem 2-B:</strong> DNS filtering. When using a VPN app you can not import DNS block-lists locally. Instead you must rely on DNS filtering done at the server-level, like how a <a href="https://pi-hole.net/">PiHole</a> operates. This has the disadvantage of forcing you to self-host an internet-facing server in order to have DNS filtering on your device, possibly incurring recurring monthly costs.</p><p>The setup described in this blogpost does not have any of the problems described above. Previous versions of this guide had UDP leaks, DNS leaks, proprietary software, and didn&apos;t allow LAN access with secure settings. In this version of the guide we have thwarted all of those problems, allowing for the best possible privacy-protecting rootless network setup.</p><h2 id="requirements">Requirements</h2><ul><li>Android 5.0+</li><li>Anywhere between 446.03 MB, up to 2500MB of available storage.</li><li>(Optional, hopefully) A computer and a cable to connect your phone to the computer.</li></ul><p>The reason so much storage space is required is because this setup needs 4 different applications and the Android work-profile. The Android work-profile occupies varying amounts of storage depending on the Android OS version.</p><h2 id="setup">Setup</h2><h3 id="getting-an-f-droid-client">Getting an F-Droid Client</h3><p>If you don&apos;t already have one, you should install an <a href="https://www.youtube.com/watch?v=JMSiTFLpUP8">f-droid client</a>. This guide uses the <a href="https://github.com/Droid-ify/client">Droid-ify</a> client (<a href="https://github.com/Droid-ify/client/releases/latest">download here</a>).</p><h3 id="insular-or-shelter">Insular or Shelter?</h3><p>The first step is setting up an Android Work Profile. Currently the only open-source options available are <a href="https://f-droid.org/packages/com.oasisfeng.island.fdroid/">Insular</a> (a fork of &quot;Island&quot;) and <a href="https://play.google.com/store/apps/details?id=net.typeblog.shelter">Shelter</a>. Insular is preferred on Android 12 (or newer) devices.</p><p>Note that name of the open-source fork is &quot;Insular&quot;, but in many places of the app the name still shows up as &quot;Island&quot;. Do not be confused by this, the app you&apos;re using is Insular.</p><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">&#x1F4A1;</div><div class="kg-callout-text"><strong>TIP: Switching from Island to Insular</strong><br>If you were a user of &quot;Island&quot;, you can switch to Insular by following these steps.<br><br>1. If you&apos;ve setup the &quot;Managed Mainland&quot; feature, you must first rescind control of the mainland (Settings &#x2192; Scoped settings &#x2192; Mainland &#x2192; Rescind). If you did not setup the &quot;Managed Mainland&quot; feature, skip to step 2.<br><br>2. Destroy the work-profile (Settings &#x2192; Scoped settings &#x2192; Island &#x2192; Rescind) <br><br>3. Uninstall the Island app.<br><br>If you&apos;ve already uninstalled Island but forgot to destroy the work-profile, you&apos;ll have to <a href="https://stackoverflow.com/a/63453017/11490425">delete Island&apos;s leftover work-profile manually using ADB</a>. Insular will <strong>not</strong> delete it for you.</div></div><p></p><p></p><p>In order to setup Insular you must first download the app and then follow the steps shown in-app.</p><p>Note from the Insular documentation:</p><blockquote>On most middle to high end Android devices released after 2016, Insular can be setup straightforward without hassle. But still on some devices, you may be notified during the setup with the error message &#x201C;Sorry, your device (or ROM) is incompatible with Insular&#x201D;, or other failures. In these cases, Insular could probably still work on your device if setup manually.</blockquote><blockquote>If you are prompted to encrypt your device during the setup, it means your device was not pre-encrypted out of box. If you don&#x2019;t want device decryption (which may significantly degrade overall I/O performance on some low-end devices), it can be avoided with manual setup.</blockquote><p>You will need a PC and a cable to connect your phone to your PC if you follow <a href="https://secure-system.gitlab.io/Insular/setup.html#manual-setup-for-island">the manual setup guide</a>.</p><h5 id="optional-features">Optional Features</h5><p>These are some <strong>optional </strong>features you might be interested in. Although they&apos;re not necessary for this guide, they are very useful for boosting personal privacy.</p><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">&#x1F4A1;</div><div class="kg-callout-text"><strong>TIP: Freeze frequently woken apps.</strong><br>Insular allows you to <strong>freeze</strong> any app in the work profile. Freezing an app blocks all its background behaviors. You can even create a launch shortcut for quick de-freezing and launching.<br><br>If you enable <a href="https://secure-system.gitlab.io/Insular/#Insularmanaged-mainland">the &quot;Managed mainland&quot; feature</a>, you can also freeze apps that are in the main profile. <a href="https://secure-system.gitlab.io/Insular/setup.html#activate-managed-mainland">Link to setup guide</a>.</div></div><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">&#x1F4A1;</div><div class="kg-callout-text"><strong>TIP: Give apps fake permissions</strong>. <br><a href="https://appops.rikka.app/">Rikka&apos;s AppOps</a> allows you to set some app&apos;s permissions to &quot;ignored&quot;, which causes apps to believe they&apos;ve been granted a permission, when in reality, if they try to use said permission they won&apos;t get any data. AppOps has work-profile support.</div></div><h3 id="setup-inviziblepro-beta">Setup InviziblePRO BETA</h3><p>First make sure you have enabled the Izzy-on-Droid f-droid repo in Droid-ify. To do that simply open the app, tap the three dots icon on the top-right corner, then tap on &quot;Repositories&quot;. There you can enable the Izzy-on-Droid repository. You can then download the <em>InviziblePRO BETA</em> app from this link: <a href="https://apt.izzysoft.de/fdroid/index/apk/pan.alexander.tordnscrypt">https://apt.izzysoft.de/fdroid/index/apk/pan.alexander.tordnscrypt</a>, or by looking up &quot;<em>InviZible Pro **BETA**</em>&quot; in droid-ify.</p><p>Once you&apos;ve installed invizible you must open the app, accept the EULA, and then disable &quot;Hide IP with TOR&quot;. Using device-wide TOR is likely to bring up many problems of services blocking TOR traffic.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/06/initial-settings.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of the main screen of Invizible. &quot;Hide IP with TOR&quot; is disabled.</figcaption></figure><p>Next we&apos;ll prevent DNS leaks from happening by enabling the setting at <em>Sidebar &#x2192; Fast Settings &#x2192; Prevent DNS leaks. </em>We&apos;ll also disable the <em>&quot;Route All traffic through Tor&quot;</em> setting.</p><!--kg-card-begin: html--><video autoplay loop muted playsinline disablepictureinpicture>
  <source src="https://itsignacioportal.github.io/assets/firewall-and-vpn-without-root-on-android-2025/fast-settings-video.webm" type="video/webm">
</video><!--kg-card-end: html--><p>Now comes the DNSCrypt settings. We must verify that DNSCrypt queries are being sent through the SOCKS5 Proxy by going to <em>Sidebar &#x2192; DNSCrypt Settings</em> and verifying that &quot;Outbound proxy&quot; is enabled, and with a <em>Proxy port</em> of &quot;5353&quot; Also make sure to <strong>disable</strong> <em>Sidebar &#x2192; DNSCrypt Settings &#x2192; Force TCP. </em>This will increase the performance of DNSCrypt.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/06/dnscrypt-settings.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of Invizible DNSCrypt settings. Force TCP is disabled, and outbound proxy is enabled.</figcaption></figure><h3 id="setup-sing-box">Setup Sing-Box</h3><blockquote>Sing-box is a fast, customizable and universal proxy platform that can be used to create network proxy servers, clients and transparent proxies. This app allows users to manage and use local and remote Sing-box profiles and provides platform specific feature implementations such as the TUN transparent proxy implementation through the Android VPN Service.</blockquote><p>Sing-box needs to be installed in the work-profile. The best way of doing this is to install an f-droid client in the work-profile, and then install Sing-box from said f-droid client. This ensures that you&apos;re always using an up-to-date version of Sing-box.</p><p>We&apos;ll install the same F-Droid client app in both profiles. Here&apos;s how you can clone an app from your main-profile into your work-profile:</p><ol><li>Open Insular.</li><li>Search for the app you want to clone.</li><li>Tap on the three dots, and then on &quot;Clone&quot;.</li></ol><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/Insular_clone-app.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="158" height="341"><figcaption>Screenshot of Insular with an app selected, highlighting the option &quot;Clone&quot; which is used to clone the selected app into the work-profile.</figcaption></figure><p>If you have Shizuku installed, you will be presented with an additional menu. There, you must select &quot;Island&quot;:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/Insular_clone-app_options.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="324" height="199"><figcaption>Screenshot of a pop-up menu in Insular. The options are &quot;via Shizuku&quot;, &quot;via Play Store&quot; and &quot;Clone app to Island&quot;.</figcaption></figure><p>Then, in the main menu of Insular go to the Island tab, select your f-droid client from the list of apps, and then open it:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/Insular_opening-fdroid-1.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="324" height="702"><figcaption>Screenshot of insular showing how to open the F-Droid client that&apos;s installed in the work-profile.</figcaption></figure><p>Then open the f-droid client, install &quot;Sing-box&quot; and open it. </p><p>In Sing-box you&apos;ll need to create a new &quot;profile&quot;:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/sing-box_profiles-menu.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="324" height="702"><figcaption>Sing-Box screenshot, first highlighting the profiles button, then the create button.</figcaption></figure><p>In this menu, select &quot;Create Manually&quot;:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/sing-box_profiles-menu_profile-creation-options.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="323" height="186"><figcaption>Screenshot of Sing-box, with the &quot;Create Manually&quot; option highlighted.</figcaption></figure><p>Give it the name &quot;SOCKS5 Proxy for InviziblePRO&quot;. Leave &quot;type&quot; as &quot;Local&quot; and &quot;Source&quot; as &quot;Create New&quot;, then press <em>Create</em>.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/Screenshot_20250708-164248.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of Sing-Box in the profile creation screen.</figcaption></figure><p>Now tap on the profile you&apos;ve just created, and then on &quot;Edit Content&quot;. In there, you must add this text:</p><!--kg-card-begin: markdown--><pre><code class="language-json">{
    &quot;outbounds&quot;:
    [
        {
            &quot;type&quot;: &quot;direct&quot;,
            &quot;tag&quot;: &quot;direct-out&quot;
        }
    ],
    &quot;inbounds&quot;:
    [
        {
            &quot;type&quot;: &quot;socks&quot;,
            &quot;tag&quot;: &quot;socks-in&quot;,
            &quot;listen&quot;: &quot;127.0.0.1&quot;,
            &quot;listen_port&quot;: 5353
        }
    ]
}
</code></pre>
<!--kg-card-end: markdown--><h3 id="inviziblepro-beta-socks5-proxy-setup">InviziblePRO BETA SOCKS5 Proxy Setup</h3><p>Now we&apos;ll setup the connection between InviziblePRO BETA and Sing-Box. First you must make sure that the Sing-Box socks5 proxy is activated. To do this simply go to the dashboard section of Sing-Box, and press the play button.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/Sing-Box_Start-socks5-proxy.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of Sing-Box, in the dashboard screen. The play button is highlighted.</figcaption></figure><p>Now open Invizible and go to <em>Sidebar &#x2192; Common Settings &#x2192; Use socks5 proxy. </em>There, leave &#x201C;Proxy server&#x201D; as &#x201C;127.0.0.1&#x201D; and set &#x201C;Proxy port&#x201D; to 5353. Also make sure to enable all of these settings in that screen:</p><ul><li>Use proxy for apps that bypass Tor.</li><li>Use proxy for DNSCrypt.</li><li>Use proxy fr Tor.</li><li>Use proxy for Purple I2P.</li></ul><p>It should look like this.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/Invizible_socks5-proxy-settings-2.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of the SOCKS5 Proxy setup screen in Invisible.</figcaption></figure><p>One last thing we must do in this screen, is exclude both Sing-Box, and the VPN app we installed. Press the &#x201C;Exclude applications&#x201D; button, and enable exclusion for sing-box and for your VPN app. If they&apos;re not on the list, then clone singbox and your VPN app into the main profile, the same way we cloned the f-droid client into the work profile.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/invizible_socks5-proxy_excluded-apps-1.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of Invisible in the exclude applications menu, Sing-Box and Proton VPN are highlighted.</figcaption></figure><h3 id="setup-the-real-vpn">Setup the real VPN</h3><p>Once that&apos;s all been setup, all that is left is to install a VPN app in the work profile. You can use the same f-droid client you used for Sing-box to look for a good VPN. Both ProtonVPN and Mullvad VPN are available on f-droid.</p><h2 id="start-everything">Start everything</h2><p>The final step of this guide is to start the apps you&apos;ve configured in the following order:</p><ol><li>Start the VPN</li><li>Start Sing-box and hit play on the profile you&apos;ve created (&quot;SOCKS5 Proxy for InviziblePRO&quot;).</li><li>Start InviziblePRO.</li></ol><p>After starting the VPN, if you did everything right, you should see some traffic starting to pop up on your VPN app:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/protonvpn-1.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="294" height="574"><figcaption>Screenshot of Proton VPN showing incoming and outgoing traffic.</figcaption></figure><p>You should also see some traffic flowing through the SOCKS5 Proxy. If no traffic is going through the SOCKS5 Proxy, you may have setup something wrong, or you may need to restart your device.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/Traffic-flow-1.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of the Android notifications, showing traffic flowing through Invisible, Proton VPN, and Sing-Box.</figcaption></figure><h2 id="verifying-everything-works">Verifying everything works</h2><p>You can verify that the VPN is working by going to any of the following sites with the VPN activated:</p><ul><li><a href="https://whatismyipaddress.com">whatismyipaddress.com</a></li><li><a href="https://browserleaks.org/dns">browserleaks.org/dns</a></li><li><a href="https://whoer.net">whoer.net</a></li></ul><p></p><p>If you wish to <strong>disconnect </strong>from the VPN without dropping any packets, do this, in this specific order:</p><!--kg-card-begin: markdown--><ol>
<li>Disable &quot;Setup SOCKS5 Proxy&quot; in RethinkDNS.</li>
<li>Stop your VPN app and the SOCKS5 proxy on &quot;Sing-box&quot;.</li>
<li>&quot;Deactivate&quot; the work profile:
<ul>
<li>If you have a notification from Insular, deactivate the work profile using the notification.</li>
<li>If you don&apos;t have the notification (see: <a href="https://gitlab.com/secure-system/Insular/-/issues/69">Insular#69</a>) use the <a href="https://www.youtube.com/watch?v=aiEm9GMp5mI">quick-settings toggle</a>:</li>
</ul>
</li>
</ol>
<!--kg-card-end: markdown--><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/quick-settings.jpg" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="324" height="702"><figcaption>Screenshot of the Android quick settings menu, with the &quot;Work apps&quot; toggle highlighted.</figcaption></figure><h2 id="hardening">Hardening</h2><p>The very last step in this guide is to harden the setup to prevent network leaks outside the firewall and VPN.</p><p>In the Android settings, go to VPN configuration and enable these settings for InviziblePRO and for the VPN you installed.</p><ul><li>Block network connections without VPN.</li><li>Always on VPN.</li></ul><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/VPN-Settings.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of the Android VPN settings.</figcaption></figure><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/VPN-Settings-Proton-VPN.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="370"><figcaption>Screenshot of the Android VPN settings, Proton VPN selected.</figcaption></figure><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/VPN-Settings-Invizible.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="393"><figcaption>Screenshot of the Android VPN settings, Invisible selected.</figcaption></figure><p>It&apos;s also recommended to go through the list of system apps in the work profile and disable any unwanted apps.</p><h1 id="faq">F.A.Q.</h1><h2 id="where-do-i-install-apps">Where do I install apps?</h2><p>All new apps must be installed <strong>in the main-profile (like you&apos;ve always done)</strong>. Apps installed in the work-profile will completely bypass InviziblePRO and their requests won&apos;t be filtered, allowing them to load ads and upload analytics data.</p><p>If you want to isolate a privacy invasive app, do not use the work profile; instead, try <a href="https://github.com/twoyi/twoyi">Twoyi</a> (<a href="https://github.com/twoyi/twoyi/releases/">download here</a>) or <a href="https://f-droid.org/repo/io.va.exposed">VirtualXPosed</a>. For testing potentially dangerous apps (apps that may contain malware) you may use <a href="https://virustotal.com">VirusTotal</a>, or the <a href="https://developer.android.com/studio">Android-Studio Android-Emulator</a>.</p><h2 id="how-do-i-block-an-apps-internet-access">How do I block an app&apos;s internet access?</h2><p>Open Invizible and go to <em>Sidebar &#x2192; Firewall</em>.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/Invizible_firewall.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of the Firewall screen in Invisible. A list of all installed apps is shown, with filtering for LAN, wifi, mobile data, and roaming.</figcaption></figure><h2 id="how-do-i-setup-dns-filtering">How do I setup DNS filtering?</h2><p>Open Invizible and go to <em>Sidebar &#x2192; DNSCrypt Settings &#x2192; Blacklist</em>.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/Invizible_dnscrypt-blacklist.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="325"><figcaption>Screenshot of the blacklist screen in Invisible. Three buttons are visible: Add remote list, add local list, and add rule.</figcaption></figure><h2 id="how-do-i-update-sing-box-and-the-vpn-app">How do I update Sing-Box and the VPN app?</h2><p>Open Insular, and then open the Droid-ify. Simply press the update button at the top to update all repositories, and then go to the &#x201C;Updates&#x201D; section.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2025/07/droid-ify_how-to-update.png" class="kg-image" alt="How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers (2025)" loading="lazy" width="325" height="704"><figcaption>Screenshot of Droid-ify.</figcaption></figure><h2 id="how-do-i-exclude-an-app-from-the-vpn">How do I exclude an app from the VPN?</h2><p>To exclude an app from the VPN (but keep the Firewall rules and DNS filters active) go to <em>Sidebar &#x2192; Common Settings &#x2192; Use socks5 proxy</em> <em>&#x2192; Exclude Applications </em>and exclude the app you want from there.</p>]]></content:encoded></item><item><title><![CDATA[Transparent data compression on Android]]></title><description><![CDATA[<h2 id="what-is-transparent-data-compression">What is &quot;transparent data compression&quot;?</h2><p>Transparent data compression consists of storing data in a compressed format and automatically decompressing it whenever it needs to be accessed, making the whole process transparent to the user. Non-transparent methods of accessing compressed data may be cumbersome to the user, as they</p>]]></description><link>https://itsignacioportal.github.io/transparent-compression-on-android/</link><guid isPermaLink="false">684adaac43d1613e68b48fdc</guid><category><![CDATA[Ideas]]></category><dc:creator><![CDATA[Ignacio J. Perez Portal]]></dc:creator><pubDate>Sat, 29 Jun 2024 03:21:08 GMT</pubDate><content:encoded><![CDATA[<h2 id="what-is-transparent-data-compression">What is &quot;transparent data compression&quot;?</h2><p>Transparent data compression consists of storing data in a compressed format and automatically decompressing it whenever it needs to be accessed, making the whole process transparent to the user. Non-transparent methods of accessing compressed data may be cumbersome to the user, as they often require manual action for the compressed data to be decompressed.</p><p>One such example of non-transparent access of compressed data would be WinRAR &quot;.rar&quot; files, which need to be manually decompressed by right-clicking the file and selecting WinRAR in the context menu before its data can be accessed.</p><h2 id="alternative-solutions-to-transparent-data-compression">Alternative solutions to transparent data compression</h2><p>The ultimate goal of transparent data compression on Android is to release more storage space to the user, but the currently available methods are extremely complicated for non tech-savy people. As an alternative to transparent data compression, consider the following solutions:</p><ul><li>Do a general cleanup using <a href="https://github.com/d4rken-org/sdmaid-se">SDMaid 2/SE</a></li><li>Scan your storage usage using <a href="https://f-droid.org/packages/com.google.android.diskusage/">DiskUsage</a> and delete big files.</li><li>Delete unused files from the Downloads folder.</li><li>Upload your files to the cloud, deleting the local copies and following <a href="https://www.seagate.com/la/es/blog/what-is-a-3-2-1-backup-strategy/">the 3-2-1 backup rule</a>.</li><li>Move apps to the SD-Card using <a href="https://play.google.com/store/apps/details?id=com.buak.Link2SD&amp;hl=en_US">Link2SD</a> and set the default install location for apps to the SD-Card using `<a href="https://android.stackexchange.com/a/43522/377089">adb shell pm setInstallLocation 2</a>`</li><li>Buy a bigger SD-Card.</li><li>Buy a phone with a bigger internal storage.</li></ul><p>The steps provided above should fix the low-storage problem for <em>most</em> users. If you&apos;re still in need of more storage though, go on reading.</p><h2 id="how-to-enable-transparent-data-compression-on-android">How to enable transparent data compression on Android</h2><p>There is no Android-native way to enable transparent data compression on Android. But for anyone determined enough, there is a workaround way to enable it on Android devices.</p><p>Transparent data compression is often implemented at the filesystem level, meaning that not all filesystems are capable of it. Most Android devices use &quot;Yet Another Flash File System v2&quot; (YAFFS2) for <code>/system</code> and <code>/cache</code> and vfat for <code>/sdcard</code>.</p><p>Other devices use F2FS, a flash-friendly filesystem that <em>does</em> support transparent data compression. </p><h3 id="enabling-compression-on-f2fs">Enabling compression on F2FS</h3><p>To check if your device supports the F2FS filesystem you&apos;ll need to have root access, and run:</p><!--kg-card-begin: markdown--><pre><code>cat /proc/filesystems
</code></pre>
<!--kg-card-end: markdown--><p>Alternatively, you can also run this command to see which filesystem flags your kernel was compiled with:</p><pre><code>zcat /proc/config.gz | grep _FS=
</code></pre><p>If F2FS is on the list of supported filesystems, you can enable compression on it by first formatting the partition with the compression option using the command <code>mkfs.f2fs -O compression /dev/sdX</code>, and then mounting it with the appropriate compression algorithm specified, such as <code>mount -o compress_algorithm=zstd /dev/sdX /mnt</code>.</p><p>To add F2FS support to a device that doesn&apos;t have it you must recompile its kernel.</p><p>If your device doesn&apos;t support F2FS, you can instead opt for NTFS, though this isn&apos;t recommended as F2FS has far better performance on flash-based devices than NTFS.</p><h3 id="enabling-compression-on-ntfs-in-android">Enabling compression on NTFS in Android</h3><p>If for some reason you opted for NTFS instead of F2FS, this would work the same way <a href="https://github.com/IridiumIO/CompactGUI">CompactGUI</a> works on Windows, allowing compressed files to be accessed transparently as-needed.</p><p>These are the steps:</p><ol><li>Recompile the Kernel with NTFS support<br>Android devices do not natively support the NTFS filesystem. Using the NTFS-3G project, it&apos;s possible to enable NTFS support. A great guide for doing this is available at <a href="https://www.xda-developers.com/full-ntfs-readwrite-support-for-android/">Full NTFS Read/Write Support for Android | XDA Developers</a>.</li><li>Insert the SD-Card into Windows.</li><li>Create an NTFS partition.</li><li>Create a /data folder.</li><li>Use compact.exe to enable the transparent compression features.</li><li>Insert the SD-Card into the phone.</li><li>Mount the NTFS partition.</li><li>Move all of the app files into their respective /data folder in the NTFS partition.</li><li>Create symbolic links for the app files.</li></ol><p>Boom, transparent compression on Android.</p><p>NOTE: I offer support for most of my guides, but not for this one. Compiling Android kernels is beyond my area of expertise, and is not something I can guide someone else through.</p>]]></content:encoded></item><item><title><![CDATA[How to use a Firewall and a VPN at the same time on Android without root, without external self-hosted servers.]]></title><description><![CDATA[No root or external servers needed. Requirements: Android 5.0+, 
446.03 MB of available storage, a computer and a cable to connect your phone.]]></description><link>https://itsignacioportal.github.io/firewall-and-vpn-without-root-on-android/</link><guid isPermaLink="false">684adaac43d1613e68b48fdb</guid><category><![CDATA[Privacy]]></category><category><![CDATA[Android]]></category><category><![CDATA[No Root]]></category><category><![CDATA[How to]]></category><dc:creator><![CDATA[Ignacio J. Perez Portal]]></dc:creator><pubDate>Thu, 09 May 2024 10:13:14 GMT</pubDate><content:encoded><![CDATA[<p>IMPORTANT: This guide is now outdated. Use this one instead: <a href="https://itsignacioportal.github.io/firewall-and-vpn-without-root-on-android-2025/">https://itsignacioportal.github.io/firewall-and-vpn-without-root-on-android-2025/</a></p><p>Unlike the previous version of this guide, this setup has:</p><ul><li>No DNS leaks.</li><li>No UDP leaks.</li><li>Less battery usage.</li><li>Only open-source software.</li></ul><h2 id="requirements">Requirements</h2><ul><li>Android 5.0+</li><li>Anywhere between 446.03 MB, up to 2500MB of available storage.</li><li>(Optional, hopefully) A computer and a cable to connect your phone to the computer.</li></ul><p>The reason so much storage space is required is because this setup needs 4 different applications and the Android work-profile. The Android work-profile occupies varying amounts of storage depending on the Android OS version.</p><p>These are the core-steps of this guide: </p><ol><li>Install <strong>RethinkDNS</strong> in the Main Android Profile.</li><li>Create an Android work-profile using <strong>Insular</strong>.</li><li>Install <strong>Sing-box</strong> in the work-profile and configure it so that it can host a SOCKS5 proxy server.</li><li>Configure RethinkDNS so it forwards all requests through the Sing-box SOCKS5 proxy server.</li><li>Install a VPN app in the work-profile.</li><li>Start the Sing-box SOCKS5 Proxy.</li><li>Start RethinkDNS.</li><li>Start the VPN.</li></ol><p>This setup has been manually tested against DNS Leaks and UDP Leaks.</p><h1 id="setup">Setup</h1><h2 id="insular-or-shelter">Insular or Shelter?</h2><p>The first step is setting up an Android Work Profile. Currently the only open-source options available are <a href="https://f-droid.org/packages/com.oasisfeng.island.fdroid/">Insular</a> (a fork of &quot;Island&quot;) and <a href="https://play.google.com/store/apps/details?id=net.typeblog.shelter">Shelter</a>. Use of &quot;Insular&quot; is preferred on Android 12 devices.</p><!--kg-card-begin: html--> <button type="button" class="collapsible">What is an Android &quot;Work Profile&quot;?</button>
<div class="content gh-content"><!--kg-card-end: html--><h3 id="android-work-profiles">Android Work Profiles</h3><p><a href="https://play.google.com/store/apps/details?id=com.oasisfeng.island">Island</a>, <a href="https://f-droid.org/packages/com.oasisfeng.island.fdroid/">Insular</a> and <a href="https://play.google.com/store/apps/details?id=net.typeblog.shelter&amp;amp;gl=US">Shelter</a> are apps which take advantage of <a href="https://developer.android.com/work/managed-profiles">Android&apos;s work-profile</a> in order to create a &quot;sandbox&quot;; This sandbox can give privacy invasive apps their own &quot;private data pools&quot; aka. their own storage for:</p><ul><li>SMS History</li><li>Call History</li><li>File Storage</li></ul><p>Having a separate profile on android also allows you to have multiple versions of a single app running simultaneously without modifying the app&apos;s APK. In contrast to other &quot;parallel apps&quot; apps, this approach allows us to easily get security updates from the playstore, as the app doesn&apos;t have to be modified and re-signed before installing it.</p><p>Another benefit of android Work Profiles are being able to hide one app from another app (For example, hiding Lucky Patcher from a game).</p><p>The greatest benefit of android Work Profiles is that <strong>they facilitate the use of two VPNs simultaneously.</strong></p><!--kg-card-begin: html--></div><!--kg-card-end: html--><p>Note that name of the open-source fork is &quot;Insular&quot;, but in many places of the app the name still shows up as &quot;Island&quot;. Do not be confused by this, the app you&apos;re using is Insular.</p><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">&#x1F4A1;</div><div class="kg-callout-text"><strong>TIP: Switching from Island to Insular</strong><br>1. If you&apos;ve setup the &quot;Managed Mainland&quot; feature, you must first rescind control of the mainland (Settings &gt; Scoped settings &gt; Mainland &gt; Rescind).<br><br>2. Destroy the work-profile (Settings &gt; Scoped settings &gt; Island &gt; Rescind) <br><br>3. Uninstall the Island app.<br><br>If you&apos;ve already uninstalled Island and forgot to destroy the work-profile, you&apos;ll have to <a href="https://stackoverflow.com/a/63453017/11490425">delete Island&apos;s leftover work-profile manually using ADB</a>. Insular will <strong>not</strong> delete it for you.</div></div><p></p><p>Steps to setup <strong>Insular</strong>:</p><p>1) Download the app: <a href="https://f-droid.org/packages/com.oasisfeng.island.fdroid/">https://f-droid.org/packages/com.oasisfeng.island.fdroid/</a></p><p>2) Launch the app and follow the setup instructions on-screen.</p><blockquote>On most middle to high end Android devices released after 2016, Insular can be setup straightforward without hassle. But still on some devices, you may be notified during the setup with the error message &#x201C;Sorry, your device (or ROM) is incompatible with Insular&#x201D;, or other failures. In these cases, Insular could probably still work on your device if setup manually.</blockquote><blockquote>If you are prompted to encrypt your device during the setup, it means your device was not pre-encrypted out of box. If you don&#x2019;t want device decryption (which may significantly degrade overall I/O performance on some low-end devices), it can be avoided with manual setup.</blockquote><p>You will need a PC and a cable to connect your phone to your PC if you follow <a href="https://secure-system.gitlab.io/Insular/setup.html#manual-setup-for-island">the manual setup guide</a>.</p><h4 id="optional-features">Optional Features</h4><p>These are some <strong>optional </strong>features you might be interested in. Although they&apos;re not necessary for this guide, they are very useful for boosting personal privacy.</p><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">&#x1F4A1;</div><div class="kg-callout-text"><strong>TIP: Freeze frequently woken apps.</strong><br>Insular allows you to <strong>freeze</strong> any app in the work profile. Freezing an app blocks all its background behaviors. You can even create a launch shortcut for quick de-freezing and launching.<br><br>If you enable <a href="https://secure-system.gitlab.io/Insular/#Insularmanaged-mainland">the &quot;Managed mainland&quot; feature</a>, you can also freeze apps that are in the main profile. <a href="https://secure-system.gitlab.io/Insular/setup.html#activate-managed-mainland">Link to setup guide</a>.</div></div><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">&#x1F4A1;</div><div class="kg-callout-text"><strong>TIP: Give apps fake permissions</strong>. <br><a href="https://appops.rikka.app/">Rikka&apos;s AppOps</a> allows you to set some app&apos;s permissions to &quot;ignored&quot;, which causes apps to believe they&apos;ve been granted a permission, when in reality, if they try to use said permission they won&apos;t get any data. AppOps has work-profile support.</div></div><h2 id="f-droid-client">F-Droid Client</h2><p>If you don&apos;t already have one, you should install an <a href="https://www.youtube.com/watch?v=JMSiTFLpUP8">f-droid client</a>. This guide uses the <a href="https://github.com/Droid-ify/client">Droid-ify</a> client (<a href="https://github.com/Droid-ify/client/releases/latest">download here</a>).</p><h2 id="rethinkdns">RethinkDNS</h2><p>Steps to setup RethinkDNS:</p><ol><li><a href="https://f-droid.org/packages/com.celzero.bravedns/">Install and open RethinkDNS</a>.</li><li>Setup the firewall (See: the &quot;Apps&quot; and &quot;Firewall&quot; sections in the app).</li><li>Setup the <a href="https://www.privacyguides.org/en/advanced/dns-overview/#what-is-dns">DNS</a> (See: the &quot;DNS&quot; section in the app). It&apos;s recommended that you use either DoT or ODoH.</li><li>Setup the DNS blocklists (See: the &quot;DNS&quot; section in the app). To enable the &quot;On-device blocklists&quot; feature, tap on the text that says &quot;Disabled&quot; in the menu that pops up, and then tap on &quot;Download Blocklists&quot;. If the download appears to be stuck, in the DNS menu enable the &quot;Use in-app downloader&quot; feature.</li></ol><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/rethinkdns_inapp-downloader-1.jpg" class="kg-image" alt loading="lazy" width="324" height="702"><figcaption>Screenshot of RethinkDNS, in the DNS settings menu with the option &quot;Use in-app downloader&quot; highlighted.</figcaption></figure><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/rethinkdns_blocklists-success-1.jpg" class="kg-image" alt loading="lazy" width="324" height="102"><figcaption>Screenshot of a RethinkDNS notification that says that the blocklists download was successful.</figcaption></figure><p></p><h2 id="sing-box">Sing-box</h2><blockquote>Sing-box is a fast, customizable and universal proxy platform that can be used to create network proxy servers, clients and transparent proxies. This app allows users to manage and use local and remote Sing-box profiles and provides platform specific feature implementations such as the TUN transparent proxy implementation through the Android VpnService.</blockquote><p>Sing-box needs to be installed in the work-profile. The best way of doing this is to install an f-droid client in the work-profile, and then install Sing-box from said f-droid client. This ensures that you&apos;re always using an up-to-date version of Sing-box.</p><p>Here&apos;s how you can clone an app from your main-profile into your work-profile:</p><ol><li>Open Insular.</li><li>Search for the app you want to clone.</li><li>Tap on the three dots, and then on &quot;Clone&quot;.</li></ol><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/Insular_clone-app.jpg" class="kg-image" alt loading="lazy" width="158" height="341"><figcaption>Screenshot of Insular with an app selected, highlighting the option &quot;Clone&quot; which is used to clone the selected app into the work-profile.</figcaption></figure><p>If you have Shizuku installed, you will be presented with an additional menu. There, you must select &quot;Island&quot;:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/Insular_clone-app_options.jpg" class="kg-image" alt loading="lazy" width="324" height="199"><figcaption>Screenshot of a pop-up menu in Insular. The options are &quot;via Shizuku&quot;, &quot;via Play Store&quot; and &quot;Clone app to Island&quot;.</figcaption></figure><p>Then, in the main menu of Insular go to the Island tab, select your f-droid client from the list of apps, and then open it:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/Insular_opening-fdroid-1.jpg" class="kg-image" alt loading="lazy" width="324" height="702"><figcaption>Screenshot of insular showing how to open the F-Droid client that&apos;s installed in the work-profile.</figcaption></figure><p>Then open the f-droid client, install &quot;Sing-box&quot; and open it. </p><p>In Sing-box you&apos;ll need to create a new &quot;profile&quot;:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2024/05/sing-box_profiles-menu.jpg" class="kg-image" alt loading="lazy" width="324" height="702"></figure><p>In this menu, select &quot;Create Manually&quot;:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/sing-box_profiles-menu_profile-creation-options.jpg" class="kg-image" alt loading="lazy" width="323" height="186"><figcaption>Screenshot of Sing-box, with the &quot;Create Manually&quot; option highlighted.</figcaption></figure><p></p><p>Give it the name &quot;SOCKS5 Proxy for RethinkDNS&quot;. Leave &quot;type&quot; as &quot;Local&quot; and &quot;Source&quot; as &quot;Create New&quot;. </p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2024/05/sing-box_new-profile.jpg" class="kg-image" alt loading="lazy" width="324" height="702"></figure><p>Tap on the profile you&apos;ve just created, and then on &quot;Edit Content&quot;. In there, you must add this text:</p><!--kg-card-begin: markdown--><pre><code class="language-json">{
    &quot;outbounds&quot;:
    [
        {
            &quot;type&quot;: &quot;direct&quot;,
            &quot;tag&quot;: &quot;direct-out&quot;
        }
    ],
    &quot;inbounds&quot;:
    [
        {
            &quot;type&quot;: &quot;socks&quot;,
            &quot;tag&quot;: &quot;socks-in&quot;,
            &quot;listen&quot;: &quot;127.0.0.1&quot;,
            &quot;listen_port&quot;: 5353,
            &quot;users&quot;:
            [
                {
                    &quot;username&quot;: &quot;admin&quot;,
                    &quot;password&quot;: &quot;SECURE_PASSWORD_HERE&quot;
                }
            ]
        }
    ]
}
</code></pre>
<!--kg-card-end: markdown--><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">&#x203C;&#xFE0F;</div><div class="kg-callout-text"><strong>WARNING: Insecure default password</strong><br>Make sure you change the password in that text with <a href="https://bitwarden.com/password-generator/">one that&apos;s actually secure</a>. Replace the text SECURE_PASSWORD_HERE.</div></div><p></p><h2 id="rethinkdns-socks5-proxy-setup">RethinkDNS SOCKS5 Proxy setup</h2><p>Go to RethinkDNS and then to the &quot;Proxy&quot; section. There you must enable the &quot;Setup SOCKS5 Proxy&quot; option; a menu will appear.</p><p>For <em>App</em>, leave it as &quot;None&quot;. Set the <em>Hostname</em> to &quot;127.0.0.1&quot;. Change the <em>Port Number</em> to 5353. Lastly, fill in your credentials: In the username field, type &quot;admin&quot;. In the password field, enter the same password you generated previously (the password where you replaced the text &quot;SECURE_PASSWORD_HERE&quot;).</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/rethinkdns_socks5-setup.jpg" class="kg-image" alt loading="lazy" width="324" height="702"><figcaption>Screenshot of RethinkDNS, setting up the SOCKS5 proxy. App = None. Port number = 5353. Username = admin. Password = your password here. &quot;Block UDP Except DNS and NTP&quot; checkbox = not checked.</figcaption></figure><p></p><h2 id="setup-the-real-vpn">Setup the real VPN</h2><p>Once that&apos;s all been setup, all that is left is to install a VPN app in the work profile. You can use the same f-droid client you used for Sing-box to look for a good VPN. Both ProtonVPN and Mullvad VPN are available on f-droid.</p><h2 id="start-everything">Start everything</h2><p>The final step of this guide is to start the apps you&apos;ve configured in the following order:</p><ol><li>Start the VPN</li><li>Start Sing-box and hit play on the profile you&apos;ve created (&quot;SOCKS5 Proxy for RethinkDNS&quot;).</li><li>Start RethinkDNS.</li></ol><p>After starting the VPN, if you did everything right, you should see some traffic starting to pop up on your VPN app:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2024/05/protonvpn-1.jpg" class="kg-image" alt loading="lazy" width="294" height="574"></figure><p>You can verify that the VPN is working by going to any of the following sites with the VPN activated:</p><ul><li><a href="https://whatismyipaddress.com">whatismyipaddress.com</a></li><li><a href="https://browserleaks.org/dns">browserleaks.org/dns</a></li><li><a href="https://whoer.net">whoer.net</a></li></ul><p></p><p>If you wish to <strong>disconnect </strong>from the VPN without dropping any packets, do this, in this specific order:</p><!--kg-card-begin: markdown--><ol>
<li>Disable &quot;Setup SOCKS5 Proxy&quot; in RethinkDNS.</li>
<li>Stop your VPN app and the SOCKS5 proxy on &quot;Sing-box&quot;.</li>
<li>&quot;Deactivate&quot; the work profile:
<ul>
<li>If you have a notification from Insular, deactivate the work profile using the notification.</li>
<li>If you don&apos;t have the notification (see: <a href="https://gitlab.com/secure-system/Insular/-/issues/69">Insular#69</a>) use the <a href="https://www.youtube.com/watch?v=aiEm9GMp5mI">quick-settings toggle</a>:</li>
</ul>
</li>
</ol>
<!--kg-card-end: markdown--><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2024/05/quick-settings.jpg" class="kg-image" alt loading="lazy" width="324" height="702"><figcaption>Screenshot of the Android quick settings menu, with the &quot;Work apps&quot; toggle highlighted.</figcaption></figure><h1 id="faq">F.A.Q.</h1><h2 id="where-do-i-install-apps">Where do I install apps?</h2><p>To be able to use all features of RethinkDNS, you must install any new apps <strong>in the main-profile (like you&apos;ve always done)</strong>. Apps installed in the work-profile will completely bypass RethinkDNS and their requests won&apos;t be filtered, allowing them to load ads and upload analytics data.</p><p>If you really want to install apps in the work profile, you can do the following:</p><p>If the VPN you&apos;ve installed in the work-profile supports <a href="https://protonvpn.com/support/protonvpn-split-tunneling/">split-tunneling</a>, you can enable the Android setting &quot;Block connections without VPN&quot; for the VPN (not for Rethink) and then add only Sing-box to the allow-list of the VPN app&apos;s split-tunneling settings. This prevents system-apps in the work profile from accessing the internet (such as Google Chrome and the Google Playstore). </p><p>This will also allow apps to be installed in the work profile with their own personal-storage-space for SMS, call logs, contacts, and files, without granting them internet access. Do note though, unlike the apps installed in the main-profile, apps installed in the work-profile will never have their requests filtered by RethinkDNS.</p><p>If you want to test a dangerous (malware-ridden) app, do not use the work-profile. Instead, use <a href="https://virustotal.com">VirusTotal</a>, <a href="https://github.com/twoyi/twoyi">Twoyi</a> (<a href="https://github.com/twoyi/twoyi/releases/">download here</a>), <a href="https://f-droid.org/repo/io.va.exposed">VirtualXPosed</a>, or an Android-Studio Android-Emulator.</p>]]></content:encoded></item><item><title><![CDATA[How to setup Etesync for Tasks.org in Windows]]></title><description><![CDATA[In this blog I will explain how to setup a local Etesync server to use it with the Tasks.org android app in a home setup.]]></description><link>https://itsignacioportal.github.io/how-to-setup-etesync-for-tasks-org-in-windows/</link><guid isPermaLink="false">684adaac43d1613e68b48fd9</guid><category><![CDATA[How to]]></category><category><![CDATA[Windows]]></category><category><![CDATA[Android]]></category><category><![CDATA[Tasks]]></category><category><![CDATA[personalDNSFilter]]></category><category><![CDATA[Etesync]]></category><category><![CDATA[Self host]]></category><dc:creator><![CDATA[Ignacio J. Perez Portal]]></dc:creator><pubDate>Thu, 09 Feb 2023 12:39:37 GMT</pubDate><content:encoded><![CDATA[<p>In this blog I will explain how to set up etesync for local use (a server that will only be exposed to your trusted LAN).</p><p>If you wish to setup etesync for it to be exposed to the internet, an advanced guide which uses nginx in WSL and internal port-forwarding is available at <a href="https://github.com/tasks/tasks/issues/1256#issuecomment-1219065064">https://github.com/tasks/tasks/issues/1256#issuecomment-1219065064</a>. I disliked that setup guide because it was too complicated and resource intensive. The setup that I&apos;ll explain here uses 0% of CPU and 58.3MB of RAM when the server is idle, and up to 0.6% of CPU when it&apos;s working (I have a Intel Core i7-4702MQ CPU @ 2.20GHz). This setup is very lightweight.</p><h1 id="setup-etesync-for-home-usage">Setup etesync for home usage</h1><h2 id="installing-git-and-python3">Installing git and python3</h2><p>To start, you will need to install git and python. The easiest way of doing this is with <a href="https://chocolatey.org/">chocolatey</a>, so <a href="https://chocolatey.org/install">open powershell as administrator</a> and run:</p><!--kg-card-begin: markdown--><pre><code class="language-powershell">Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString(&apos;https://community.chocolatey.org/install.ps1&apos;))
</code></pre>
<!--kg-card-end: markdown--><p>After chocolatey has finished installing, close powershell and open it again as administrator. Run:</p><!--kg-card-begin: markdown--><pre><code class="language-powershell">choco install git
choco install python3
</code></pre>
<!--kg-card-end: markdown--><h2 id="installing-etesync">Installing etesync</h2><p>We will now setup the etesync server. To do this, open the Command Prompt (cmd) and run these commands:</p><!--kg-card-begin: markdown--><pre><code class="language-batch">cd %appdata%\..\Local
mkdir Etesync &amp;&amp; cd Etesync
git clone https://github.com/ItsIgnacioPortal/etesync-server.git etebase
setx etesyncpath %appdata%\..\Local\Etesync\
mkdir etebase_storage &amp;&amp; cd etebase_storage &amp;&amp; mkdir static &amp;&amp; mkdir media
</code></pre>
<!--kg-card-end: markdown--><p>Note that you&apos;re using my fork of the etesync-server repo. If it ever becomes outdated and you wish to get the latest version of the server, just take note of <a href="https://github.com/ItsIgnacioPortal/etesync-server/commits/master/requirements-win.txt">the changes I did in requierements-win.txt</a>, then clone <a href="https://github.com/etesync/server">the main repo</a>, and apply the changes to the requierements.txt</p><p>Now in an administrator command prompt:</p><pre><code class="language-powershell">cd %etesyncpath%\etebase
pip install -r requirements-win.txt</code></pre><p>Now open your favorite text editor and paste this:</p><pre><code class="language-ini">[global]
secret_file = secret.txt
debug = false
;Set the paths where data will be stored at
static_root = C:\Users\User\AppData\Local\Etesync\etebase_storage\static
media_root = C:\Users\User\AppData\Local\Etesync\etebase_storage\media

;Advanced options, only uncomment if you know what you&apos;re doing:
;static_url = /static/
;media_url = /user-media/
;language_code = en-us
;time_zone = UTC
;redis_uri = redis://localhost:6379

[allowed_hosts]
allowed_host1 = your.local.domain.here.com

[database]
engine = django.db.backends.sqlite3
name = db.sqlite3

[database-options]
; Add engine-specific options here, such as postgresql parameter key words

;[ldap]
;server = &lt;The URL to your LDAP server&gt;
;search_base = &lt;Your search base&gt;
;filter = &lt;Your LDAP filter query. &apos;%%s&apos; will be substituted for the username&gt;
; In case a cache TTL of 1 hour is too short for you, set `cache_ttl` to the preferred
; amount of hours a cache entry should be viewed as valid:
;cache_ttl = 5
;bind_dn = &lt;Your LDAP &quot;user&quot; to bind as. Must be a bind user&gt;
; Either specify the password directly, or provide a password file
;bind_pw = &lt;The password to authenticate as your bind user&gt;
;bind_pw_file = /path/to/the/file.txt</code></pre><p>Save it in <strong>C:\Users\User\AppData\Local\Etesync\etebase</strong> (replace your username there) as <strong>etebase-server.ini</strong></p><p>Note that in that file you have to modify the value of &quot;static_root&quot; and &quot;media_root&quot; so it has your correct windows username. Also, here is where we select what domain we&apos;ll be using. No, you don&apos;t need to register any domains, we&apos;ll do all of this locally. But we must pick a domain name for HTTPS to work. So in that file replace &quot;your.local.domain.here.com&quot; with whichever domain name you want.</p><p>Now in the command prompt run:</p><!--kg-card-begin: markdown--><pre><code class="language-batch">python %etesyncpath%\etebase\manage.py migrate
</code></pre>
<!--kg-card-end: markdown--><p>We need to tell windows what our domain name is. Open a text editor as administrator and open &quot;C:\Windows\System32\drivers\etc\hosts&quot;. Add these lines at the bottom of the file:</p><!--kg-card-begin: markdown--><pre><code>#etesync server
YOUR-PC-WIFI-IP-ADDRESS your.local.domain.here.com
</code></pre>
<!--kg-card-end: markdown--><p>Finally, run:</p><!--kg-card-begin: markdown--><pre><code class="language-batch">cd %etesyncpath%\etebase
uvicorn etebase_server.asgi:application --host your.local.domain.here.com --port 8001
</code></pre>
<!--kg-card-end: markdown--><p>And your server will be live! Though the setup isn&apos;t done yet. Press CTRL+C and run these commands to setup some files and create an administrator user (Note: when you type the password, it won&apos;t be visible. Be careful with how you type!)</p><!--kg-card-begin: markdown--><pre><code class="language-batch">python %etesyncpath%\etebase\manage.py collectstatic
python %etesyncpath%\etebase\manage.py createsuperuser
</code></pre>
<!--kg-card-end: markdown--><p>Now the setup for the server is done. We now have to setup the web interface. Download this file: <a href="https://pim.etesync.com/etesync-web.tgz" rel="nofollow">https://pim.etesync.com/etesync-web.tgz</a> and extract it in <strong>C:\Users\User\AppData\Local\Etesync\ </strong>so that index.html is at <strong>C:\Users\User\AppData\Local\Etesync\etesync-web\index.html</strong> using 7zip. You&apos;ll have to install 7zip if you don&apos;t already have it installed:</p><!--kg-card-begin: markdown--><pre><code class="language-powershell">choco install 7zip
</code></pre>
<!--kg-card-end: markdown--><p>To have HTTPS you must follow <a href="https://devopscube.com/create-self-signed-certificates-openssl/">this tutorial</a>. It&apos;s fairly complicated, but it&apos;s needed to have a secure connection with our server. After you&apos;ve generated your rootCA.crt you have to install it in your windows PC, and in your phone.</p><ul><li>Double click your rootCA.crt</li><li>Install certificate...</li><li>Store location -&gt; Local Machine</li><li>Next</li><li>Browse -&gt; &quot;Trusted Root Certification Authorities&quot;</li><li>Then finish the setup</li></ul><p>For android, the setting to install a custom certificate was in Settings -&gt; Security &amp; Location -&gt; (Advanced) -&gt; Encryption &amp; credentials -&gt; Install from SD card (You don&apos;t actually need an SD card to use this option).</p><h2 id="start-the-servers">Start the servers:</h2><!--kg-card-begin: markdown--><pre><code class="language-batch">cd %etesyncpath%\etebase
python -m uvicorn etebase_server.asgi:application --port 8001 --host your.local.domain.here.com --ssl-keyfile=&quot;C:\Users\User\AppData\Local\Etesync\cert\server.key&quot; --ssl-certfile=&quot;C:\Users\User\AppData\Local\Etesync\cert\server.crt&quot;
</code></pre>
<!--kg-card-end: markdown--><p>In another terminal:</p><!--kg-card-begin: markdown--><pre><code class="language-batch">cd %etesyncpath%\etesync-web\
python -m http.server 8002 --bind your.local.domain.here.com
</code></pre>
<!--kg-card-end: markdown--><h2 id="setup-groups-and-your-user">Setup groups and your user</h2><p>Now to setup the etesync users go to <strong>https://your.local.domain.here.com:8001/admin</strong> in your browser. There you need to enter the admin credentials you setup earlier.</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2023/02/django-login.png" class="kg-image" alt loading="lazy" width="394" height="289"></figure><p>Now you will have to create a group. Go to Groups -&gt; New</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2023/02/django-new-group.png" class="kg-image" alt loading="lazy" width="629" height="232" srcset="https://itsignacioportal.github.io/content/images/size/w600/2023/02/django-new-group.png 600w, https://itsignacioportal.github.io/content/images/2023/02/django-new-group.png 629w"></figure><p>And now name your group <strong>Etesync users</strong>. Below you have to double click ALL of the options that start with &quot;django_etebase&quot; until they&apos;re all in the right side. When you&apos;re done click save.</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2023/02/django-setup-groups.png" class="kg-image" alt loading="lazy" width="977" height="606" srcset="https://itsignacioportal.github.io/content/images/size/w600/2023/02/django-setup-groups.png 600w, https://itsignacioportal.github.io/content/images/2023/02/django-setup-groups.png 977w" sizes="(min-width: 720px) 720px"></figure><p>Once that&apos;s done, click on Users-&gt;New on the left side-bar</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2023/02/django-new-user.png" class="kg-image" alt loading="lazy" width="281" height="274"></figure><p>Pick a username, then continue. Before continuing to fill the form, set the user&apos;s password by clicking on the tiny link on the left:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2023/02/django-new-user_set-password.png" class="kg-image" alt loading="lazy" width="897" height="73" srcset="https://itsignacioportal.github.io/content/images/size/w600/2023/02/django-new-user_set-password.png 600w, https://itsignacioportal.github.io/content/images/2023/02/django-new-user_set-password.png 897w" sizes="(min-width: 720px) 720px"></figure><p>Set your password and hit continue. Fill in your user information, and then add yourself to the &quot;Etesync users&quot; group. Just double click on &quot;Etesync users&quot; in the <em>Available groups</em> menu, then click SAVE.</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2023/02/django-new-user_set-groups.png" class="kg-image" alt loading="lazy" width="966" height="418" srcset="https://itsignacioportal.github.io/content/images/size/w600/2023/02/django-new-user_set-groups.png 600w, https://itsignacioportal.github.io/content/images/2023/02/django-new-user_set-groups.png 966w" sizes="(min-width: 720px) 720px"></figure><p>Next we&apos;ll create a firewall rule to allow your phone to be able to talk to your etesync server. Open a command prompt as administrator and run:</p><!--kg-card-begin: markdown--><pre><code class="language-batch">netsh advfirewall firewall add rule name= &quot;Etesync TCP&quot; dir=in action=allow protocol=TCP localport=8001
netsh advfirewall firewall add rule name= &quot;Etesync UDP&quot; dir=in action=allow protocol=UDP localport=8001
</code></pre>
<!--kg-card-end: markdown--><p>And that&apos;s all done on the PC side! Now for the android setup:</p><h2 id="setup-tasksorg">Setup tasks.org</h2><p>To setup your domain in android, there&apos;s several ways. The options available are</p><ul><li><a href="https://pi-hole.net/">pihole</a></li><li><a href="https://nextdns.io/">NextDNS</a></li><li><a href="https://www.zenz-solutions.de/personaldnsfilter-wp/">personalDNSfilter</a></li></ul><p>Since personalDNSfilter doesn&apos;t need any external services, and it&apos;s open source, that&apos;s what I&apos;ll use here. Just go through the app setup, and when you&apos;re done go to <em>Advanced settings</em> -&gt; <em>Configure additional hosts </em>and add your domain name according to the format explained there:</p><!--kg-card-begin: markdown--><pre><code>&gt;your.local.domain.here.com PC-IP-ADDRESS
</code></pre>
<!--kg-card-end: markdown--><p>If you&apos;re a NetGuard user, you might have to enable <em>Three dots</em> -&gt; <em>Settings</em> -&gt; <em>Network Options</em> -&gt; <em>Subnet routing. </em>If you would like to use NetGuard and personalDNSfilter at the same time, check my other blogpost: <a href="https://itsignacioportal.github.io/netguard-pdnsf-any-vpn-combo/">How to use NetGuard + personalDNSFilter+ Any VPN, without root, without external self-hosted servers.</a></p><p>Now go to the <em>Tasks.org app</em> -&gt; <em>Settings</em> -&gt; <em>Add account</em> -&gt; <em>EteSync</em> and then write the username and password that you setup earlier in django. Enable &quot;Show advanced settings&quot; and set the URL to <strong>https://your.local.domain.here.com:8001</strong></p><p>After that hit the save button and you&apos;re done! Etesync is up and running. You can access the web interface in your PC on <strong>http://your.local.domain.here.com:8002</strong></p><p>Note that in that page you will also have to enable &quot;Advanced settings&quot; and set the URL to <strong>https://your.local.domain.here.com:8001</strong></p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2023/02/etesync-web.png" class="kg-image" alt loading="lazy" width="1343" height="810" srcset="https://itsignacioportal.github.io/content/images/size/w600/2023/02/etesync-web.png 600w, https://itsignacioportal.github.io/content/images/size/w1000/2023/02/etesync-web.png 1000w, https://itsignacioportal.github.io/content/images/2023/02/etesync-web.png 1343w" sizes="(min-width: 720px) 720px"></figure><p>If you&apos;re a firefox user you might get stuck in &quot;Deriving encryption&quot;. If that&apos;s the case, <a href="https://github.com/etesync/etesync-web/issues/237">you have to disable enhanced tracking protection and whitelist your domain in uBlockOrigin</a>. You might also have to clear the cookies and local storage if it gets stuck during sign-in. The easiest way to do that is by using Cookie Auto Delete:</p><ul><li><a href="https://addons.mozilla.org/firefox/addon/cookie-autodelete/">CAD for Firefox</a></li><li><a href="https://chrome.google.com/webstore/detail/cookie-autodelete/fhcgjolkccmbidfldomjliifgaodjagh">CAD for Google Chrome</a></li><li><a href="https://microsoftedge.microsoft.com/addons/detail/djkjpnciiommncecmdefpdllknjdmmmo">CAD for Edge Chromium version</a></li></ul><p>Here&apos;s how the tasks menu looks in etesync as of writing this:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2023/02/etesync-web-tasks.png" class="kg-image" alt loading="lazy" width="1343" height="723" srcset="https://itsignacioportal.github.io/content/images/size/w600/2023/02/etesync-web-tasks.png 600w, https://itsignacioportal.github.io/content/images/size/w1000/2023/02/etesync-web-tasks.png 1000w, https://itsignacioportal.github.io/content/images/2023/02/etesync-web-tasks.png 1343w" sizes="(min-width: 720px) 720px"></figure><p>Note that Tasks.org won&apos;t immediately upload all of your lists to your etesync instance. Instead, <strong>a new section will appear in the sidebar with your etesync username</strong>. To get your tasks to etesync you will have to select them, and then move them to their corresponding collection in etesync:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2023/02/tasks-org-collage.png" class="kg-image" alt loading="lazy" width="511" height="555"></figure><p>You can use the script below on your PC to quickly start the etesync server and it&apos;s web interface. Just save it in a file and double click it to launch it. Press CTRL+C on both windows to stop the server.</p><pre><code class="language-batch">@echo off
start cmd /k cd %etesyncpath%\etebase ^&amp;^&amp; python -m uvicorn etebase_server.asgi:application --port 8001 --host your.local.domain.here --ssl-keyfile=&quot;C:\Users\User\AppData\Local\Etesync\cert\server.key&quot; --ssl-certfile=&quot;C:\Users\User\AppData\Local\Etesync\cert\server.crt&quot; ^&amp; pause ^&amp;^&amp; exit

cd %etesyncpath%\etesync-web
python -m http.server 8002 --bind your.local.domain.here &amp; pause &amp;&amp; exit</code></pre>]]></content:encoded></item><item><title><![CDATA[How to use NetGuard + personalDNSFilter+ Any VPN, without root, without external self-hosted servers.]]></title><description><![CDATA[No root or external servers neeeded. Requirements: Android 5.0+, 
446.03 MB of available storage, a computer and a cable to connect your phone.]]></description><link>https://itsignacioportal.github.io/netguard-pdnsf-any-vpn-combo/</link><guid isPermaLink="false">684adaac43d1613e68b48fd8</guid><category><![CDATA[Privacy]]></category><category><![CDATA[No Root]]></category><category><![CDATA[Android]]></category><category><![CDATA[VPN]]></category><category><![CDATA[NetGuard]]></category><category><![CDATA[personalDNSFilter]]></category><category><![CDATA[pDNSf]]></category><dc:creator><![CDATA[Ignacio J. Perez Portal]]></dc:creator><pubDate>Thu, 24 Mar 2022 06:59:16 GMT</pubDate><content:encoded><![CDATA[<p>IMPORTANT: This guide is now outdated. Use this one instead: <a href="https://itsignacioportal.github.io/firewall-and-vpn-without-root-on-android-2025/">https://itsignacioportal.github.io/firewall-and-vpn-without-root-on-android-2025/</a></p><p>Together, with the people over at the <a href="https://www.zenz-solutions.de/personaldnsfilter-wp/">personalDNSfilter</a> Telegram group, we&apos;ve discovered a way to run multiple &quot;VPN&quot;s at the same time by taking advantage of <a href="https://developer.android.com/work/managed-profiles">work profiles</a>.</p><p>All of this started because I was trying to control Work-profile apps using the Netguard instance that I had on my main profile.</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/M66B_Netguard-no-work-profile-4.jpg" class="kg-image" alt="Screenshot. M66B saying that netguard has no work-profile support" loading="lazy" width="804" height="432" srcset="https://itsignacioportal.github.io/content/images/size/w600/2022/03/M66B_Netguard-no-work-profile-4.jpg 600w, https://itsignacioportal.github.io/content/images/2022/03/M66B_Netguard-no-work-profile-4.jpg 804w" sizes="(min-width: 720px) 720px"></figure><p>After I read <a href="https://forum.xda-developers.com/t/app-6-0-netguard-no-root-firewall.3233012/post-80571423">that comment</a> from the Netguard dev, I realized that the work profile had a separate VPN slot, so therefor, it&apos;s possible for us to have an actual VPN and a SOCKS5 proxy server in the work profile, and then connect to this SOCKS5 proxy from the main profile using NetGuard. Below is a flowchart of how this whole thing is going to work:</p><!--kg-card-begin: html--><a href="https://imgur.com/a/FDzrffF" target="_blank" alt="Full resolution picture of the flowchart."><!--kg-card-end: html--><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2023/01/BbHYaSd.png" class="kg-image" alt loading="lazy" width="2000" height="1092" srcset="https://itsignacioportal.github.io/content/images/size/w600/2023/01/BbHYaSd.png 600w, https://itsignacioportal.github.io/content/images/size/w1000/2023/01/BbHYaSd.png 1000w, https://itsignacioportal.github.io/content/images/size/w1600/2023/01/BbHYaSd.png 1600w, https://itsignacioportal.github.io/content/images/size/w2400/2023/01/BbHYaSd.png 2400w" sizes="(min-width: 720px) 720px"><figcaption>A flowchart of how this whole setup works</figcaption></figure><!--kg-card-begin: html--></a><!--kg-card-end: html--><p>Don&apos;t worry, the rest of this blog was written in a non-technical way, so it&apos;s easy to follow for non-technical people. </p><p>This has been tested on Android 9, on a Moto e6 plus. This blog assumes that you already know:</p><ul><li>How to install an APK</li><li>How to use ADB</li></ul><h2 id="requirements">Requirements</h2><ul><li>Android 5.0+</li><li>446.03 MB (446,030,000 bytes) of available storage</li><li>(Optional, hopefully) A computer and a cable to connect your phone to the computer.</li></ul><p>Why so much storage?</p><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th>Item</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>Work Profile: Island + ProtonVPN + SOCKS5 Proxy + System stuff</td>
<td>398.53MB</td>
</tr>
<tr>
<td>NetGuard</td>
<td>17.09MB</td>
</tr>
<tr>
<td>personalDNSFilter</td>
<td>5.67MB</td>
</tr>
<tr>
<td>Island</td>
<td>24.74MB</td>
</tr>
<tr>
<td>TOTAL</td>
<td>446.03MB</td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><h1 id="setup-caveats">Setup caveats</h1><h2 id="warning-udp-leaks">WARNING: UDP LEAKS</h2><p>Netguard does not currently support sending UDP traffic over the SOCKS5 proxy. This causes protocols which use UDP (such as HTTP/2 and HTTP/3) to ignore the proxy and go over the clearnet, completely bypassing this setup. Until this issue is resolved, there&apos;s two possible solutions.</p><h3 id="solution-1-replace-netguard-and-personaldnsfilter-with-rethink-dns-firewall">Solution #1: Replace Netguard and personalDNSfilter with &quot;Rethink DNS + Firewall&quot;</h3><p>Unlike Netguard, RethinkDNS supports UDP tunneling through a SOCKS5 proxy. RethinkDNS doesn&apos;t have DNS leaks, and you can use the &quot;Block connections without VPN&quot; android setting with it. If you&apos;re a networking pro, you should be able to do that using this guide as a vague reference; but if you&apos;re not as technically inclined, read on:</p><h3 id="solution-2-use-mull-with-custom-aboutconfig-settings">Solution #2: Use mull with custom about:config settings</h3><p>If you just want to use a browser, you can keep Netguard and personalDNSfilter. But you&apos;ll have to use <a href="https://github.com/Divested-Mobile/mull-fenix">Mull (a hardened fork of Firefox for Android)</a> with &quot;network.http.http2.enabled = false&quot;, and &quot;network.http.http3.enable = false&quot; in <strong><a href="about:config">about:config</a></strong>. You must do this to avoid leaks with this setup because HTTP versions greater than v1.1 use UDP.<br><br>If instead you want to use the Tor browser, you don&apos;t need to change any settings, since <a href="https://tor.stackexchange.com/questions/16419/why-tor-doesnt-support-udp">Tor does not use</a>, <a href="https://tor.stackexchange.com/questions/4523/can-i-use-tor-through-udp-protocol">nor support UDP</a>.</p><hr><p>If you&apos;re 100% sure that the app(s) you&apos;ll use do not use UDP, you can continue with this specific setup. If you&apos;re not sure, then rest assured that at least Tor can be used safely with this setup, but allowing any other apps through the firewall risks revealing your identity to the web services you interact with.</p><p>Scroll down to the TL;DR to see other possible ways to use a Firewall and a VPN at the same time.</p><hr><h2 id="dns-leaks-if-personaldnsfilter-isnt-initialized">DNS Leaks if personalDNSfilter isn&apos;t initialized</h2><p>DNS queries will leak through the clearnet if personalDNSfilter isn&apos;t initialized once traffic is being routed through Netguard. To prevent any possible leaks, make sure personalDNSfilter is initialized before enabling the SOCKS5 proxy in Netguard.</p><p>This issue has been brought up to the developer of Netguard, and he&apos;s been unable to determine the cause.</p><p><em><a href="https://github.com/ItsIgnacioPortal/ItsIgnacioPortal.github.io/discussions/1?notification_referrer_id=NT_kwDOAsIFGbMzMzg1NzE2MTk2OjQ2MjY5NzIx#discussioncomment-5886624">I&apos;d like to thank &quot;FLAGEL&quot; for briging these issues to my attention.</a></em></p><h2 id="battery-usage">Battery usage</h2><p>Because we&apos;re running multiple profiles and apps at the same time, this setup is fairly energy hungry. NetGuard and personalDNSfilter have a very small battery footprint, but the Android work profile is very resource intensive.</p><h2 id="unsupported-devices">Unsupported devices</h2><p>Some brands/devices do not fully support using a VPN in the work profile. <a href="https://forum.xda-developers.com/t/app-6-0-netguard-no-root-firewall.3233012/post-86334119">To quote M66B</a> (emphasis added):</p><blockquote>NetGuard is supported in the primary profile only. <strong>It might or might not work in other profiles</strong>, but this scenario is not supported because is basically isn&apos;t supportable. I have wasted enough time on trying to support this in the past.<br><br>Something like &quot;Shelter&quot; is not standard Android and a manufacturer modification, which is the core problem because these modifications often do not take the Android VPN service into account too.</blockquote><p>This setup might or might not work in your device, so make sure you test it before doing anything &quot;risky&quot;. This guide is known not to work on <em>some</em> LG devices running Android 9. I&apos;ve personally tested it in a <em>Moto e6 plus</em> with stock Android 9 and it works well.</p><!--kg-card-begin: html--> <button type="button" class="collapsible">Expand TL;DR (too long; didn&apos;t read) (does not open a new tab)</button>
<div class="content gh-content"><!--kg-card-end: html--><p>There&apos;s many ways you can use a Firewall and a VPN at the same time (sorted from easiest to most complicated):</p><ul><li>Use <a href="https://forum.xda-developers.com/t/adhell-3-knox.3908002/">Adhell 3</a>, the Samsung KNOX based content-blocker that doesn&apos;t require root and also allows you to use a VPN app at the same time.</li><li>Use AFWall+ (root required) instead of NetGuard. That way you can have a firewall and still use VPN apps &quot;normally&quot;.</li><li><strong>Install a VPN app and a SOCKS5 proxy server in <a href="https://developer.android.com/work/managed-profiles" rel="nofollow noreferrer">the Android work profile</a>, and then connect to this SOCKS5 proxy from the main profile using NetGuard.</strong></li><li>Use a VPN provider that already offers a SOCKS5 proxy (like <a href="https://mullvad.net/en/help/socks5-proxy/" rel="nofollow noreferrer">Mullvad</a>), and then connect to this SOCKS5 proxy from NetGuard (Not recommended due to Netguard&apos;s UDP issues, and SOCKS5 not being encrypted)</li><li>Self-host a <a href="https://github.com/Tosainu/docker-fortivpn-socks5" rel="nofollow noreferrer">VPN-to-SOCKS5 server</a> (Not recommended due to Netguard&apos;s UDP issues, and SOCKS5 not being encrypted)</li></ul><p>Also see: <a href="https://android.stackexchange.com/questions/182341/how-to-use-a-firewall-and-a-vpn/247835#247835">https://android.stackexchange.com/questions/182341/how-to-use-a-firewall-and-a-vpn/247835#247835</a></p><p>I&apos;ve only ever used the highlighted option, so that&apos;s what I&apos;ll describe here.</p><p></p><p><strong>Pros</strong>:</p><ul><li>It doesn&apos;t require root</li><li>You don&apos;t have to pay for a specific VPN (you can use Proton VPN)</li><li>You don&apos;t have to run/pay for any servers</li></ul><p></p><p><strong>Cons</strong>:</p><ul><li>NetGuard leaks the UDP packets to the clearnet. An alternative solution is to use RethinkDNS instead of Netguard, or use <strong>only</strong> a browser that has HTTP/2 &amp; HTTP/3 disabled through about:config, or use <strong>only</strong> the Tor Browser (because Tor doesn&apos;t use nor support UDP). Any other traffic <strong>will</strong> be leaked.</li><li>The work profile has to be enabled constantly for the VPN to stay running, and that uses a considerable ammount of battery.</li><li>The Android work profile requires about 398.53MB of storage.</li><li>The VPN service doesn&apos;t fully work on <em>some</em> Android devices: It&apos;s known not to work in some LG devices running Android 9, but it does work in a <em>Moto e6 Plus</em> running Android 9.</li></ul><p></p><p>Steps:</p><ol><li>Install personalDNSfilter</li><li>Install Island or Shelter (Preferibly Shelter, because it&apos;s FOSS and has no trackers)</li><li>Setup Island/Shelter</li><li>Setup personalDNSfilter to your liking</li><li>Install &quot;Every Proxy&quot; in the work profile</li><li>Install a VPN app (such as Proton VPN) in the work profile</li><li>Disable battery optimizations for all of the apps you just installed (personalDNSfilter, Every Proxy, Proton VPN, and Island/Shelter)</li><li>Configure &quot;Every Proxy&quot; to run a SOCKS5 proxy on the 10.1.10.1 interface, and set a username and password (Warning: do not make the password 126 characters long, that causes a crash. I recommend making the password 40 characters long.)</li><li>Make sure NetGuard is running</li><li>Start the SOCKS5 proxy in &quot;Every Proxy&quot;</li><li>Set personalDNSfilter in Netguard as &quot;unmanaged&quot; (untick the &quot;apply rules and conditions&quot; box)</li><li>In Netguard set the DNS servers to any WAN servers (for example: 94.140.14.14, and 94.149.14.15) (nothing will be sent to these servers)</li><li>Create TCP and UDP forwarding rules for 127.0.0.1:53 -&gt; 127.0.0.1:5300 to personalDNSfilter in NetGuard. <em>Note that this isn&apos;t possible if you downloaded NetGuard from the google playstore. You must download netguard from either Github or from F-Droid</em></li><li>Configure Netguard to use a SOCKS5 proxy server (10.1.10.1:1088, and input the same username and password as you did in &quot;Every Proxy&quot;)</li></ol><!--kg-card-begin: html--></div><!--kg-card-end: html--><!--kg-card-begin: html--> <button type="button" class="collapsible">Expand the glossary (does not open a new tab)</button>
<div class="content gh-content"><!--kg-card-end: html--><h1 id="glossary">Glossary</h1><h2 id="work-profiles">Work Profiles</h2><p><a href="https://play.google.com/store/apps/details?id=com.oasisfeng.island">Island</a> and <a href="https://play.google.com/store/apps/details?id=net.typeblog.shelter&amp;amp;gl=US">Shelter</a> are apps which take advantage of <a href="https://developer.android.com/work/managed-profiles">Android&apos;s work-profile</a> &#xA0;in order to create a &quot;sandbox&quot;; Using this sandbox, we can give privacy invasive apps their own &quot;private data pools&quot;, aka, their own storage for:</p><ul><li>SMS History</li><li>Call History</li><li>File Storage</li></ul><p>Having a separate profile on android also allows you to have multiple versions of a single app running simultaneously without modifying the app&apos;s APK. In contrast to other &quot;parallel apps&quot; apps, this approach allows us to easily get security updates from the playstore, as the app doesn&apos;t have to be re-signed in the first place.</p><p>There&apos;s also the benefit of being able to hide an app from another app (For example, hiding Lucky Patcher from a game).</p><p>And lastly, but most important, <strong>a work profile allows us to have two VPNs at the same time</strong>.</p><h2 id="f-droid">F-Droid</h2><p>F-Droid is an app store and software repository for Android, serving a similar function to the Google Play store. The main repository, hosted by the project, contains only free and open source apps. Applications can be browsed, downloaded and installed from the F-Droid website or client app without the need to register for an account.</p><h2 id="socks5-proxy">SOCKS5 Proxy</h2><p><strong>SOCKS</strong> is an <a href="https://en.wikipedia.org/wiki/Internet">Internet</a> <a href="https://en.wikipedia.org/wiki/Protocol_(computing)">protocol</a> that exchanges <a href="https://en.wikipedia.org/wiki/Packet_(information_technology)">network packets</a> between a <a href="https://en.wikipedia.org/wiki/Client_(computing)">client</a> and <a href="https://en.wikipedia.org/wiki/Server_(computing)">server</a> through a <a href="https://en.wikipedia.org/wiki/Proxy_server">proxy server</a>. <strong>SOCKS5</strong> optionally provides <a href="https://en.wikipedia.org/wiki/Authentication">authentication</a> so only authorized users may access a server. Practically, a SOCKS server proxies TCP connections to an arbitrary IP address, and provides a means for UDP packets to be forwarded.</p><h2 id="network-port">Network Port</h2><p>In <a href="https://en.wikipedia.org/wiki/Computer_networking">computer networking</a>, a <b>port</b> is a communication endpoint. At the software level, within an <a href="https://en.wikipedia.org/wiki/Operating_system">operating system</a>, a port is a logical construct that identifies a specific <a href="https://en.wikipedia.org/wiki/Process_(computing)">process</a> or a type of <a href="https://en.wikipedia.org/wiki/Network_service">network service</a>. A port is identified for each <a href="https://en.wikipedia.org/wiki/Transport_protocol">transport protocol</a> and address combination by a 16-bit <a href="https://en.wikipedia.org/wiki/Unsigned_number">unsigned number</a>, known as the <b>port number</b>. The most common transport protocols that use port numbers are the <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol">Transmission Control Protocol</a> (TCP) and the <a href="https://en.wikipedia.org/wiki/User_Datagram_Protocol">User Datagram Protocol</a> (UDP).</p><p>A port number is always associated with an <a href="https://en.wikipedia.org/wiki/IP_address">IP address</a> of a host and the type of transport protocol used for communication. It completes the destination or origination <a href="https://en.wikipedia.org/wiki/Network_address">network address</a> of a message. Specific port numbers are reserved to identify specific services so that an arriving packet can be easily forwarded to a running application. For this purpose, port numbers lower than 1024 identify the historically most commonly used services and are called the <a href="https://en.wikipedia.org/wiki/Well-known_port_numbers">well-known port numbers</a>. Higher-numbered ports are available for general use by applications and are known as <a href="https://en.wikipedia.org/wiki/Ephemeral_port">ephemeral ports</a>.</p><h2 id="ip-address">IP Address</h2><p>An <b>Internet Protocol address</b> (<b>IP address</b>) is a numerical label such as <i>192.0.2.1</i> that is connected to a <a href="https://en.wikipedia.org/wiki/Computer_network">computer network</a> that uses the <a href="https://en.wikipedia.org/wiki/Internet_Protocol">Internet Protocol</a> for communication.<sup><a href="https://en.wikipedia.org/wiki/IP_address#cite_note-rfc760-1">[1]</a><a href="https://en.wikipedia.org/wiki/IP_address#cite_note-rfc791-2">[2]</a></sup> An IP address serves two main functions: network interface <a href="https://en.wikipedia.org/wiki/Identification_(information)">identification</a> and location <a href="https://en.wikipedia.org/wiki/Network_address">addressing</a>.</p><p><a href="https://en.wikipedia.org/wiki/IPv4">Internet Protocol version 4</a> (IPv4) defines an IP address as a <a href="https://en.wikipedia.org/wiki/32-bit">32-bit</a> number.<sup><a href="https://en.wikipedia.org/wiki/IP_address#cite_note-rfc791-2">[2]</a></sup> However, because of the growth of the <a href="https://en.wikipedia.org/wiki/Internet">Internet</a> and the <a href="https://en.wikipedia.org/wiki/IPv4_address_exhaustion">depletion of available IPv4 addresses</a>, a new version of IP (<a href="https://en.wikipedia.org/wiki/IPv6">IPv6</a>), using 128 bits for the IP address, was standardized in 1998.<sup><a href="https://en.wikipedia.org/wiki/IP_address#cite_note-rfc1883-3">[3]</a><a href="https://en.wikipedia.org/wiki/IP_address#cite_note-rfc2460-4">[4]</a><a href="https://en.wikipedia.org/wiki/IP_address#cite_note-rfc8200-5">[5]</a></sup> <a href="https://en.wikipedia.org/wiki/IPv6_deployment">IPv6 deployment</a> has been ongoing since the mid-2000s.</p><p>IP addresses are written and displayed in <a href="https://en.wikipedia.org/wiki/Human-readable">human-readable</a> notations, such as <i>192.0.2.1</i> in IPv4, and <i>2001:db8:0:1234:0:567:8:1</i> in IPv6. The size of the routing prefix of the address is designated in <a href="https://en.wikipedia.org/wiki/CIDR_notation">CIDR notation</a> by suffixing the address with the number of <a href="https://en.wikipedia.org/wiki/Bit_numbering">significant bits</a>, e.g., <i>192.0.2.1/24</i>, which is equivalent to the historically used <a href="https://en.wikipedia.org/wiki/Subnet_mask">subnet mask</a> <i>255.255.255.0</i>.</p><p>TL;DR: Your phone can have multiple IP Addresses (aka Network connections), and every port must be associated with an IP Address.</p><!--kg-card-begin: html--></div><!--kg-card-end: html--><h1 id="index">Index</h1><!--kg-card-begin: markdown--><ul>
<li><a href="#Setup">Setup</a>
<ul>
<li><a href="#island-or-shelter">Island or Shelter?</a></li>
<li><a href="#netguard">NetGuard</a>
<ul>
<li><a href="#installing-the-app">Installing the app</a></li>
</ul>
</li>
<li><a href="#why-personaldnsfilter">Why personalDNSfilter?</a></li>
<li><a href="#installing-personaldnsfilter">Installating personalDNSfilter</a></li>
<li><a href="#installing-the-socks5-proxy">Installing the SOCKS5 proxy</a></li>
<li><a href="#configuring-netguard">Configuring NetGuard</a></li>
<li><a href="#installing-the-actual-vpn">Installing the actual VPN</a></li>
</ul>
</li>
<li><a href="#conclussion">Conclusion</a></li>
</ul>
<!--kg-card-end: markdown--><h1 id="setup">Setup</h1><h2 id="island-or-shelter">Island or Shelter?</h2><p>We must install one of these two apps. <a href="https://reports.exodus-privacy.eu.org/reports/191535/">Island contains Google trackers</a>, but it has a bigger userbase, therefor, less bugs. Meanwhile, Shelter is completely open-source, but has a smaller userbase. For this tutorial I&apos;ll be using Island, since that&apos;s what I&apos;m currently using, but feel free to use Shelter if you prefer so. </p><p>1) Download the app: <a href="https://play.google.com/store/apps/details?id=com.oasisfeng.island&amp;amp;gl=US">https://play.google.com/store/apps/details?id=com.oasisfeng.island&amp;amp;gl=US</a></p><p>2) Launch the app and follow the setup instructions given by Island.</p><blockquote>On most middle to high end Android devices released after 2016, Island can be setup straightforward without hassle. But still on some devices, you may got &#x201C;incompatible with your device&#x201D; message on Google Play Store, or be notified during the setup with error message &#x201C;Sorry, your device (or ROM) is incompatible with Island&#x201D;, or other failures. In these cases, Island could probably still work on your device if setup manually.</blockquote><blockquote>If you are prompted to encrypt your device during the setup, it means your device was not pre-encrypted out of box. If you don&#x2019;t want device decription (which may significantly degrade overall I/O performance on some low-end devices), it can be avoided with manual setup.</blockquote><p>You will need a PC and a cable to connect your phone to your PC if you follow <a href="https://island.oasisfeng.com/setup.html">the manual setup guide</a>.</p><p>While you&apos;re at it, you might also want to setup these cool (but not necessary for this guide) features:</p><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">&#x1F4A1;</div><div class="kg-callout-text"><strong>TIP: Freeze frequently woken apps.</strong><br>Island allows you to <strong>freeze</strong> any app in the work profile. Freezing an app blocks all its background behaviors. You can even create a launch shortcut for quick de-freezing and launching.<br><br>If you enable <a href="https://island.oasisfeng.com/#managed-mainland">the &quot;Managed mainland&quot; feature</a> you can also freeze apps that are in the main profile. <a href="https://island.oasisfeng.com/setup.html#activate-managed-mainland">Link to setup guide</a>.</div></div><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">&#x1F4A1;</div><div class="kg-callout-text"><strong>TIP: Give apps fake permissions</strong>. <br><a href="https://appops.rikka.app/">AppOps</a> allows you to set some app permissions to &quot;ignored&quot;, which make it so that the app thinks that it does have a permission, but when it tries to actually use it, it doesn&apos;t get any data. AppOps has work-profile support.</div></div><h2 id="netguard">Netguard</h2><p>Netguard is a FOSS app that allows us to control exactly which apps have access to the internet, and which don&apos;t. We can give an app WiFi access, mobile data access, or make it so that netguard doesn&apos;t control the app at all. </p><h3 id="installing-the-app">Installing the app</h3><p>Here, we have two options: Installing from GitHub, or installing from F-Droid. We can&apos;t install netguard from the playstore because <strong>the playstore release doesn&apos;t support port-forwarding</strong>, and that feature is obligatory for us to be able to do our trick.</p><p>I recommend installing NetGuard from F-Droid, since it&apos;s easier to update it from there. If you don&apos;t already have an F-Droid client, I recommend using <a href="https://gitlab.com/AuroraOSS/auroradroid/-/releases">AuroraDroid</a>. Simply download the APK file, and install it. After opening the app and finishing the setup, search for &quot;NetGuard&quot; and install the first result.</p><p>I recommend spending some time fine-tweaking which apps you give internet access to. Most apps only ask for internet access to show you ads/collect analytics.</p><h2 id="why-personaldnsfilter">Why personalDNSfilter?</h2><p>The Netguard version from github already has hosts blacklists, so why not use just that? Well, Netguard&apos;s host blacklist implementation has a number of <a href="https://github.com/M66B/NetGuard/blob/master/ADBLOCKING.md">drawbacks</a>:</p><blockquote>NetGuard ignores the IP addresses in the hosts file, because it does not route blocked domains to localhost.</blockquote><blockquote>Wildcards are not supported due to performance and battery usage reasons.</blockquote><blockquote>It is not possible to edit the hosts file (change/add/delete domain names) with NetGuard</blockquote><p>Also:</p><ul><li>Host blocklists have to be updated manually.</li><li>You can&apos;t view exactly which domains have been blocked.</li><li>You can&apos;t create your own custom DNS resolutions: This is necessary if you&apos;re into self-hosting and you want HTTPS without a public domain.</li></ul><p><a href="https://www.zenz-solutions.de/personaldnsfilter-wp/">personalDNSfilter</a> overcomes all of these problems, and so for that reason I strongly recommend it.</p><h2 id="installing-personaldnsfilter">Installing personalDNSfilter</h2><p>This one&apos;s easy. You can either install it from F-Droid (using AuroraDroid), or you can install it from the playstore. They&apos;re both the same.</p><p>After installing the app, tap on &quot;Advanced settings&quot; and make them match this:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/pDNSf-config-1.jpg" class="kg-image" alt="Screenshot of Advanced settings in personalDNSFilter. CNAME Cloaking protection: ON. DNS proxy mode without local VPN: ON. Allow only local DNS proxy requests: ON. Root mode without local VPN: OFF." loading="lazy" width="323" height="391"></figure><p>What we&apos;re doing here, is configuring pDNSf so it doesn&apos;t use a VPN slot, but instead opens a &quot;DNS proxy&quot; on port 5300. </p><h2 id="installing-the-socks5-proxy">Installing the SOCKS5 proxy</h2><p>Now, you must launch the Google Playstore from within Island:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/island-launching-playstore-1.jpg" class="kg-image" alt="Screenshot of Launching the Google Playstore from within the Island app" loading="lazy" width="325" height="703"></figure><p>Now search and install &quot;Every Proxy&quot;. &quot;Every Proxy&quot; has no ads, and no trackers, hence, why I picked it. Make sure NetGuard is up and running on the main profile, and then launch the EveryProxy app, and hit the three dots on the top left corner, then &quot;Settings&quot;. Scroll down to the bottom and make your settings match this:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/everyproxy-config-1.jpg" class="kg-image" alt="Screenshot of configuration for the SOCKS5 proxy in Every Proxy. IP Address: 10.1.10.1. Port: 1088. Power save: Off. Auto Start at startup: Off. Enable basic authentication: On. Username: redacted. Password: redacted. More secure: On. " loading="lazy" width="328" height="544"></figure><p>Of course, you must create a username and password. You don&apos;t really need to remember the password. Just copy it to your clipboard. (IMPORTANT: DO NOT make the password 126 characters long, else netguard will enter a crash loop that might crash your entire phone). Now go back to the main screen of the app, and start the SOCKS5 proxy. Make sure to disable battery optimizations for &quot;Every Proxy&quot;, else Android might kill the app unexpectedly. If you don&apos;t know how to disable these optimizations, go to <a href="dontkillmyapp.com">dontkillmyapp.com</a>. </p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://itsignacioportal.github.io/content/images/2022/03/everyproxy-socks5-started-1.jpg" class="kg-image" alt="Screenshot of Every Proxy with SOCKS5 On." loading="lazy" width="327" height="355"><figcaption>&quot;Every Proxy&quot; with the SOCKS5 proxy activated</figcaption></figure><h2 id="configuring-netguard">Configuring Netguard</h2><p>Now you must go back to your main profile and open Netguard. Do NOT &quot;Deactivate&quot; the work profile.</p><p>Here&apos;s the tricky part. Go into NetGuard -&gt; Three Dots (on the top right corner) -&gt; Settings -&gt; Advanced Options -&gt; Port Forwarding</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/netguard-port-forwarding-1.jpg" class="kg-image" alt loading="lazy" width="327" height="260"></figure><p>Once you&apos;re inside that menu, click the &quot;<strong>+</strong>&quot; icon on the top right corner. Make the details match the following screenshot:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/netguard-port-forwarding_detail-2.jpg" class="kg-image" alt="Screenshot of netguard configuration. Protocol: TCP. Destination address: 127.0.0.1. Destination port: 5300. Destination app: personalDNSFilter." loading="lazy" width="292" height="459"></figure><p>Click OK. Now do the exact same thing again, but instead of selecting &quot;TCP&quot;, select &quot;UDP&quot;.</p><p>Basically, what we&apos;re doing is configuring netguard so whenever an outbound DNS request goes through port 53, it will be redirected to localhost (127.0.0.1) to port 5300 to personalDNSFilter. We use port 5300 because that&apos;s the only port that pDNSf can work on without having root, without occupying the VPN slot.</p><p>Now go back to the main screen of the app. Look for &quot;personalDNSFilter&quot; and untick the &quot;Apply rules and conditions&quot; checkbox:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/netguard-pdnsf-1.jpg" class="kg-image" alt="screenshot of personalDNSfilter being excluded from control by netguard." loading="lazy" width="326" height="191"></figure><p>We do this so that there isn&apos;t an infinite DNS loopback: For example, if Google Chrome wants to resolve example.com, then the request will go through NetGuard, which will use 127.0.0.1 as the DNS resolver. pDNSf will resolve it according to its configuration, but when it makes the outbound dns resolution request to it&apos;s configured DNS servers, that request will be caught by NetGuard, which will try to resolve it using 127.0.0.1, so pDNSf requests tries to resolve it, but its caught by NetGuard, who tries to resolve it using 127.0.0.1, so pDNSf requests tries to resolve it, and so on and so forth....</p><p>Now we have to configure netguard to use the SOCKS5 proxy. Go to NetGuard -&gt; Three Dots (on the top right corner) -&gt; Settings -&gt; Advanced Options and scroll down to the section about the SOCKS5 Proxies:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/netguard-socks5-1.jpg" class="kg-image" alt="Netguard config screenshot. SOCKS5 address: 10.1.10.1. SOCKS5 port: 1088. Socks5 username: redacted. Socks5 password: redacted." loading="lazy" width="330" height="263"></figure><p>The &quot;SOCKS5 username&quot; and the &quot;SOCKS5 password&quot; must match the username and password that you configured on &quot;Every Proxy&quot;.</p><p>Lastly, we have to configure the <em>VPN DNS</em>. Go to &quot;Settings&quot; -&gt; &quot;Advanced Options&quot; and scroll down. Set both &quot;VPN DNS&quot; settings to<strong> any WAN external server </strong>(Avoid &quot;localhost&quot;, &quot;127.0.0.1&quot;, &quot;10.1.10.1&quot;, &quot;192.168.0.1&quot;, and such. Copy me if you&apos;re not sure on what server to use). It doesn&apos;t matter what servers you pick here, your DNS requests won&apos;t be sent to these servers. The DNS requests will be redirected to pDNSf thanks to the forwarding rule we setup earlier.</p><p>Why not just put &quot;127.0.0.1&quot; as the VPN DNS you ask? To put it simply, NetGuard has DNS Leaks which can only be avoided using this hacky method. Without this workaround, who our ISP is would be exposed, and nobody wants that!</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/netguard_VPN-DNS.png" class="kg-image" alt loading="lazy" width="325" height="184"></figure><p> If you want more information about how this whole setup works, <a href="https://imgur.com/a/FDzrffF">click here</a>.</p><h2 id="installing-the-actual-vpn">Installing the actual VPN</h2><p>Finally! Just like you installed &quot;Every Proxy&quot; on the work profile, now do the same but instead look for the VPN that you want. In my case, I&apos;ll be using ProtonVPN.</p><p>After starting the VPN, if you did everything right, you should see some traffic starting to pop up on your VPN app:</p><figure class="kg-card kg-image-card"><img src="https://itsignacioportal.github.io/content/images/2022/03/protonvpn-1.jpg" class="kg-image" alt="Screenshot of ProtonVPN with traffic coming through." loading="lazy" width="294" height="574"></figure><p>You can verify that the VPN is working by going to any of the following sites with the VPN activated:</p><ul><li><a href="https://whatismyipaddress.com">whatismyipaddress.com</a></li><li><a href="https://browserleaks.org/dns">browserleaks.org/dns</a></li><li><a href="https://whoer.net">whoer.net</a></li></ul><p>Just make sure that your browser is controlled by NetGuard, else it will just bypass the entire system.</p><p>If you wish to <strong>disconnect </strong>from the VPN without dropping any packets, do this, in this specific order:</p><ul><li>Disable &quot;Use SOCKS5 proxy&quot; in NetGuard.</li><li>Stop your VPN app and the SOCKS5 proxy on &quot;Every Proxy&quot; (the order of these two steps doesn&apos;t matter, hence why they&apos;re combined in a single bullet point).</li><li>&quot;Deactivate&quot; the work profile using the notification from Island.</li></ul>]]></content:encoded></item></channel></rss>